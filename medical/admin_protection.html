<!DOCTYPE html>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="firebase-config.js"></script>

<script>
    // ุงูุชุฃูุฏ ูู ุญุงูุฉ ุงููุณุชุฎุฏู
    firebase.auth().onAuthStateChanged((user) => {
        if (!user) {
            // ุฅุฐุง ูู ููู ูุณุฌูุงูุ ุงุทุฑุฏู ูุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
            window.location.href = "login.html";
        }
    });

    function logout() {
        firebase.auth().signOut().then(() => {
            window.location.href = "login.html";
        });
    }
</script>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style.css">
    <title>ุฅุฏุงุฑุฉ ุงูููุงูุฉ ุงูุฅุดุนุงุนูุฉ - ูุงููุฑุง ุทุจูุฉ</title>
</head>
<body>
    <nav>
        <a href="admin_hub.html" class="logo">ุฅุฏุงุฑุฉ ุงูููุงูุฉ ๐ก๏ธ</a>
        <button class="btn-primary" onclick="location.href='admin_hub.html'" style="width:auto; padding: 5px 15px;">โฌ๏ธ ุงูุนูุฏุฉ</button>
    </nav>

    <div class="container">
        <div class="card">
            <h2 style="color:var(--orange); text-align:center;">โ ุฅุถุงูุฉ ุชุนูููุงุช ููุงูุฉ ุฌุฏูุฏุฉ</h2>
            
            <input type="text" id="prot-title" placeholder="ุนููุงู ุงูุฅุฌุฑุงุก (ูุซูุงู: ููุงุนุฏ ุฏุฎูู ุบุฑูุฉ ุงูู CT)" style="width:100%; padding:12px; margin-bottom:15px; border-radius:8px; border:1px solid var(--orange); background:transparent; color:white;">
            
            <select id="prot-cat" style="width:100%; padding:12px; margin-bottom:15px; border-radius:8px; background:#001f3f; color:white; border:1px solid var(--orange);">
                <option value="Staff">ุญูุงูุฉ ุงููุงุฏุฑ (Occupational)</option>
                <option value="Patient">ุญูุงูุฉ ุงููุฑูุถ (Patient Safety)</option>
                <option value="Public">ุญูุงูุฉ ุงูุฌูููุฑ (Public)</option>
            </select>

            <textarea id="prot-desc" rows="5" placeholder="ุงูุชุจ ุงูุชุนูููุงุช ูุงูููุงุฆุญ ููุง..." style="width:100%; padding:12px; border-radius:8px; border:1px solid var(--orange); background:transparent; color:white; margin-bottom:15px;"></textarea>

            <label>ุตูุฑุฉ ุชูุถูุญูุฉ ุฃู ุจูุณุชุฑ:</label>
            <input type="file" id="prot-img" accept="image/*" style="color:white; margin-bottom:15px;">
            
            <button class="btn-primary" onclick="saveProtection()">๐ ูุดุฑ ุงูุชุนูููุงุช</button>
        </div>

        <div class="card">
            <h3 style="color:var(--yellow);">๐ ุงูููุงุฆุญ ุงูููุดูุฑุฉ:</h3>
            <div id="prot-list"></div>
        </div>
    </div>

    <script>
        async function saveProtection() {
            const title = document.getElementById('prot-title').value;
            const cat = document.getElementById('prot-cat').value;
            const desc = document.getElementById('prot-desc').value;
            const imgFile = document.getElementById('prot-img').files[0];

            if(!title || !desc) return alert("ูุฑุฌู ููุก ุงูุญููู ุงูุฃุณุงุณูุฉ");

            let imageData = "";
            if (imgFile) {
                imageData = await new Promise(resolve => {
                    const reader = new FileReader();
                    reader.onload = e => resolve(e.target.result);
                    reader.readAsDataURL(imgFile);
                });
            }

            const newItem = { id: Date.now(), title, cat, desc, img: imageData };
            let data = JSON.parse(localStorage.getItem('rad_protection')) || [];
            data.push(newItem);
            localStorage.setItem('rad_protection', JSON.stringify(data));
            
            alert("ุชู ุญูุธ ุงูุชุนูููุงุช!");
            location.reload();
        }

        window.onload = function() {
            const list = document.getElementById('prot-list');
            const data = JSON.parse(localStorage.getItem('rad_protection')) || [];
            list.innerHTML = data.map((item, i) => `
                <div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #333;">
                    <span><b>[${item.cat}]</b> ${item.title}</span>
                    <button onclick="deleteProt(${i})" style="color:red; background:none; border:none; cursor:pointer;">ุญุฐู ๐๏ธ</button>
                </div>
            `).join('');
        };

        function deleteProt(i) {
            let data = JSON.parse(localStorage.getItem('rad_protection'));
            data.splice(i, 1);
            localStorage.setItem('rad_protection', JSON.stringify(data));
            location.reload();
        }
    </script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="firebase-config.js"></script>
    
    
    
    <script>
    const COLLECTION = "protection"; // ๐ก ุบูุฑูุง ุฅูู us_lessons ุฃู rad_protection ุญุณุจ ุงูุตูุญุฉ

    async function saveData() {
        const title = document.querySelector('input').value;
        const desc = document.querySelector('textarea').value;
        
        await db.collection(COLLECTION).add({
            title, desc, createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        location.reload();
    }

    // ุฌูุจ ุงูุจูุงูุงุช ููุญุฐู
    window.onload = async function() {
        const snap = await db.collection(COLLECTION).orderBy("createdAt", "desc").get();
        document.getElementById('data-list').innerHTML = snap.docs.map(doc => `
            <div style="display:flex; justify-content:space-between; padding:10px;">
                <span>${doc.data().title}</span>
                <button onclick="db.collection('${COLLECTION}').doc('${doc.id}').delete().then(()=>location.reload())">ุญุฐู ๐๏ธ</button>
            </div>
        `).join('');
    };
</script>
</body>
</html>