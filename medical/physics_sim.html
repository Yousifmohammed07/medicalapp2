<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Ù…Ø­Ø§ÙƒÙŠ Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø¹ÙŠØ© - ÙƒØ§Ù…ÙŠØ±Ø§ Ø·Ø¨ÙŠØ©</title>
    <style>
        .sim-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        @media (max-width: 768px) { .sim-container { grid-template-columns: 1fr; } }

        .control-panel { background: rgba(0, 31, 63, 0.5); padding: 20px; border-radius: 15px; border: 1px solid var(--orange); }
        .preview-panel { background: #000; border-radius: 15px; padding: 20px; text-align: center; }
        
        .image-preview-box { 
            width: 100%; height: 400px; background: #111; 
            margin: 0 auto; border-radius: 10px; position: relative; border: 3px solid #333;
            overflow: hidden; display: flex; align-items: center; justify-content: center;
        }

        #real-xray-img {
            max-width: 100%; max-height: 100%; object-fit: contain;
            filter: grayscale(100%); transition: filter 0.2s;
        }

        #noise-layer { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            pointer-events: none; opacity: 0; z-index: 2;
            background-image: url('https://www.transparenttextures.com/patterns/stardust.png');
            mix-blend-mode: overlay;
        }

        .upload-btn {
            background: var(--orange); color: var(--navy); padding: 10px; 
            border-radius: 8px; cursor: pointer; display: inline-block; margin-bottom: 15px;
            font-weight: bold; width: 100%; text-align: center;
        }

        .slider-group { margin-bottom: 20px; }
        input[type=range] { width: 100%; accent-color: var(--orange); cursor: pointer; }
        .stat-box { display: flex; justify-content: space-between; margin-top: 10px; font-size: 0.85rem; }
    </style>
</head>
<body>
    <nav>
        <a href="index.html" class="logo">ÙƒØ§Ù…ÙŠØ±Ø§ Ø·Ø¨ÙŠØ© ğŸ“·</a>
        <div class="dropdown">
            <button onclick="toggleMenu()" class="dropbtn">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© â˜°</button>
            <div id="myDropdown" class="dropdown-content">
               <a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                <a href="physics_calc.html">Ø§Ù„Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¦ÙŠØ© ğŸ§®</a>
                <a href="contrast_guide.html">Ø¯Ù„ÙŠÙ„ Ø§Ù„ØµØ¨ØºØ§Øª ğŸ§ª</a>
                <a href="exam.html">Ù…Ø±ÙƒØ² Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</a>
                <a href="anatomy.html">ØªØ­Ø¯ÙŠ Ø§Ù„ØªØ´Ø±ÙŠØ­</a>
                <a href="atlas.html">Ø£Ø·Ù„Ø³ Ø§Ù„ÙˆØ¶Ø¹ÙŠØ§Øª</a>
                <a href="artifacts.html">Ù…Ø®ØªØ¨Ø± Ø§Ù„ØµÙˆØ±</a>
                <a href="safety.html">ØªØ­Ø¯ÙŠ Ø§Ù„Ø³Ù„Ø§Ù…Ø©</a>
                <a href="ct.html">CT Scan</a>
                <a href="xray.html">X-ray</a>
                <a href="mri.html">MRI</a>
                <a href="ultrasound.html">ÙÙŠØ²ÙŠØ§Ø¡ Ø§Ù„Ø³ÙˆÙ†Ø§Ø± ğŸ”Š</a>
                <a href="qc_lab.html">Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø±Ù‚Ø§Ø¨Ø© Ø§Ù„Ù†ÙˆØ¹ÙŠØ© ğŸ› ï¸</a>
                <a href="protection.html">Ø§Ù„ÙˆÙ‚Ø§ÙŠØ© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø¹ÙŠØ© ğŸ›¡ï¸</a>
                <a href="physics_sim.html">Ù…Ø­Ø§ÙƒÙŠ Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡ âš›ï¸</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <h1 style="text-align:center; color:var(--yellow); margin-top:20px;">âš›ï¸ Ù…Ø­Ø§ÙƒÙŠ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¬ÙˆØ¯Ø© Ø§Ù„ØµÙˆØ±Ø©</h1>
        
        <div class="sim-container">
            <div class="control-panel">
                <h3 style="color:var(--orange);">âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h3>
                
                <label for="file-upload" class="upload-btn">ğŸ“ Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ø£Ø´Ø¹Ø© Ù„Ù„ØªØ¬Ø±Ø¨Ø©</label>
                <input type="file" id="file-upload" accept="image/*" style="display:none" onchange="loadImage(event)">

                <div class="slider-group">
                    <label>Ø§Ù„Ø¬Ù‡Ø¯ ($kVp$): <span id="kvp-val" style="color:var(--yellow)">70</span> kV</label>
                    <input type="range" id="kvp-slider" min="40" max="120" value="70" oninput="updateSim()">
                </div>

                <div class="slider-group">
                    <label>Ø§Ù„ØªÙŠØ§Ø± ($mAs$): <span id="mas-val" style="color:var(--yellow)">15</span> mAs</label>
                    <input type="range" id="mas-slider" min="1" max="100" value="15" oninput="updateSim()">
                </div>

                <div class="stat-box"><span>Ø§Ù„Ø¬Ø±Ø¹Ø© (Dose):</span> <span id="dose-status">-</span></div>
                <div class="stat-box"><span>Ø§Ù„ØªØ¨Ø§ÙŠÙ† (Contrast):</span> <span id="contrast-status">-</span></div>
                <div class="stat-box"><span>Ø§Ù„Ø¶ÙˆØ¶Ø§Ø¡ (Noise):</span> <span id="noise-status">-</span></div>
            </div>

            <div class="preview-panel">
                <div class="image-preview-box" id="drop-zone">
                    <img id="real-xray-img" src="https://via.placeholder.com/400x400/222/ffd700?text=Upload+X-ray+Image" alt="Preview">
                    <div id="noise-layer"></div>
                </div>
                <p style="color:gray; font-size:0.8rem; margin-top:10px;">Ø§Ø±ÙØ¹ ØµÙˆØ±Ø© Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù„ØªØ±Ù‰ ÙƒÙŠÙ ÙŠØªØºÙŠØ± Ø§Ù„ØªØ¨Ø§ÙŠÙ† ÙˆØ§Ù„ØªØ´ÙˆÙŠØ´ Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹.</p>
            </div>
        </div>
    </div>

    <script>
        // Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©
        function loadImage(event) {
            const reader = new FileReader();
            reader.onload = function() {
                const img = document.getElementById('real-xray-img');
                img.src = reader.result;
            }
            reader.readAsDataURL(event.target.files[0]);
        }

        function updateSim() {
            const kvp = parseInt(document.getElementById('kvp-slider').value);
            const mas = parseInt(document.getElementById('mas-slider').value);
            document.getElementById('kvp-val').innerText = kvp;
            document.getElementById('mas-val').innerText = mas;

            const xrayImg = document.getElementById('real-xray-img');
            const noiseLayer = document.getElementById('noise-layer');

            // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ØªØ¨Ø§ÙŠÙ† (Contrast)
            let contrastFactor = 1 + ((75 - kvp) * 0.02);
            let brightnessFactor = 1 - ((75 - kvp) * 0.005);
            xrayImg.style.filter = `grayscale(100%) contrast(${contrastFactor}) brightness(${brightnessFactor})`;

            // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø¶ÙˆØ¶Ø§Ø¡ (Noise)
            noiseLayer.style.opacity = (1 / Math.sqrt(mas)) * 2;

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª
            const dose = (mas * Math.pow(kvp, 2)) / 10000;
            document.getElementById('dose-status').innerText = dose > 8 ? "Ù…Ø±ØªÙØ¹Ø© âš ï¸" : "Ø¢Ù…Ù†Ø© âœ…";
            document.getElementById('contrast-status').innerText = kvp > 90 ? "Ù…Ù†Ø®ÙØ¶" : "Ø¬ÙŠØ¯";
            document.getElementById('noise-status').innerText = mas < 10 ? "Ù…Ø±ØªÙØ¹" : "Ù…Ù†Ø®ÙØ¶";
        }

        function toggleMenu() { document.getElementById("myDropdown").classList.toggle("show"); }
        window.onload = updateSim;
    </script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="firebase-config.js"></script>
</body>
</html>