<!DOCTYPE html>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="firebase-config.js"></script>

<script>
    // ุงูุชุฃูุฏ ูู ุญุงูุฉ ุงููุณุชุฎุฏู
    firebase.auth().onAuthStateChanged((user) => {
        if (!user) {
            // ุฅุฐุง ูู ููู ูุณุฌูุงูุ ุงุทุฑุฏู ูุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
            window.location.href = "login.html";
        }
    });

    function logout() {
        firebase.auth().signOut().then(() => {
            window.location.href = "login.html";
        });
    }
</script>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style.css">
    <title>ุฅุฏุงุฑุฉ ูุฎุชุจุฑ ุงูุฃุฎุทุงุก - ูุงููุฑุง ุทุจูุฉ</title>
    <style>
        .input-group { margin-bottom: 15px; }
        input, textarea, select { 
            width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--orange); 
            background: rgba(255,255,255,0.05); color: white; box-sizing: border-box; 
        }
        label { display: block; margin-bottom: 5px; color: var(--yellow); }
    </style>
</head>
<body>
    <nav>
        <a href="admin_hub.html" class="logo">ุฅุฏุงุฑุฉ ุงููุฎุชุจุฑ ๐ผ๏ธ</a>
        <button class="btn-primary" onclick="location.href='admin_hub.html'" style="width:auto; padding: 5px 15px;">โฌ๏ธ ุงูุนูุฏุฉ ูููุฑูุฒ</button>
    </nav>

    <div class="container">
        <div class="card">
            <h2 style="color:var(--orange); text-align:center;">๐ฌ ุฅุถุงูุฉ ุฎุทุฃ ููุฒูุงุฆู (Artifact) ุฌุฏูุฏ</h2>
            
            <div class="input-group">
                <label>ููุน ุงูุฌูุงุฒ (Modality):</label>
                <select id="art-modality">
                    <option value="MRI">ุงูุฑููู ุงููุบูุงุทูุณู (MRI)</option>
                    <option value="CT">ุงูููุฑุงุณ (CT Scan)</option>
                    <option value="X-ray">ุงูุฃุดุนุฉ ุงูุณูููุฉ (X-ray)</option>
                </select>
            </div>

            <div class="input-group">
                <label>ุงุณู ุงูุฎุทุฃ (ุงูุชุดุฎูุต ุงูุตุญูุญ):</label>
                <input type="text" id="art-title" placeholder="ูุซูุงู: Chemical Shift Artifact">
            </div>

            <div class="input-group">
                <label>ุตูุฑุฉ ุงูุฎุทุฃ (ูู ุงูุงุณุชูุฏูู):</label>
                <input type="file" id="art-img" accept="image/*">
            </div>

            <div class="input-group" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                <div><label>ุฎูุงุฑ 1:</label><input type="text" id="opt-0"></div>
                <div><label>ุฎูุงุฑ 2:</label><input type="text" id="opt-1"></div>
                <div><label>ุฎูุงุฑ 3:</label><input type="text" id="opt-2"></div>
            </div>

            <div class="input-group">
                <label>ุฑูู ุงูุฎูุงุฑ ุงูุตุญูุญ (0 ุฃู 1 ุฃู 2):</label>
                <input type="number" id="correct-idx" min="0" max="2" value="0">
            </div>

            <div class="input-group">
                <label>ุงูุชูุณูุฑ ุงูููุฒูุงุฆู ูููููุฉ ุงูุนูุงุฌ:</label>
                <textarea id="art-exp" rows="4" placeholder="ุงุดุฑุญ ููุงุฐุง ุญุฏุซ ูุฐุง ุงูุฎุทุฃ ูููู ูููู ูููุตูุฑ ุชุฌูุจู..."></textarea>
            </div>
            
            <button class="btn-primary" onclick="saveArtifact()">๐ ุฅุถุงูุฉ ูููุฎุชุจุฑ</button>
        </div>

        <div class="card">
            <h2 style="color:var(--yellow);">๐ ุงูุฃุฎุทุงุก ุงููุถุงูุฉ ุญุงููุงู</h2>
            <div id="artifacts-list"></div>
        </div>
    </div>

    <script>
        async function saveArtifact() {
            const imgFile = document.getElementById('art-img').files[0];
            const title = document.getElementById('art-title').value;
            if(!imgFile || !title) return alert("ูุฑุฌู ุฑูุน ุงูุตูุฑุฉ ููุชุงุจุฉ ุงูุงุณู!");

            const reader = new FileReader();
            reader.onload = function(e) {
                const newArt = {
                    id: Date.now(),
                    modality: document.getElementById('art-modality').value,
                    title: title,
                    img: e.target.result,
                    options: [
                        document.getElementById('opt-0').value,
                        document.getElementById('opt-1').value,
                        document.getElementById('opt-2').value
                    ],
                    correct: parseInt(document.getElementById('correct-idx').value),
                    explanation: document.getElementById('art-exp').value
                };

                let data = JSON.parse(localStorage.getItem('custom_artifacts')) || [];
                data.push(newArt);
                localStorage.setItem('custom_artifacts', JSON.stringify(data));
                alert("ุชูุช ุฅุถุงูุฉ ุงูุฎุทุฃ ุจูุฌุงุญ!");
                location.reload();
            };
            reader.readAsDataURL(imgFile);
        }

        window.onload = function() {
            const list = document.getElementById('artifacts-list');
            const data = JSON.parse(localStorage.getItem('custom_artifacts')) || [];
            list.innerHTML = data.map((art, i) => `
                <div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #333;">
                    <span>[${art.modality}] ${art.title}</span>
                    <button onclick="deleteArt(${i})" style="color:red; background:none; border:none; cursor:pointer;">ุญุฐู ๐๏ธ</button>
                </div>
            `).join('');
        };

        function deleteArt(i) {
            let data = JSON.parse(localStorage.getItem('custom_artifacts'));
            data.splice(i, 1);
            localStorage.setItem('custom_artifacts', JSON.stringify(data));
            location.reload();
        }
    </script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="firebase-config.js"></script>
    
    <script>
    const COLLECTION = "artifacts"; // ๐ก ุบูุฑูุง ุฅูู us_lessons ุฃู rad_protection ุญุณุจ ุงูุตูุญุฉ

    async function saveData() {
        const title = document.querySelector('input').value;
        const desc = document.querySelector('textarea').value;
        
        await db.collection(COLLECTION).add({
            title, desc, createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        location.reload();
    }

    // ุฌูุจ ุงูุจูุงูุงุช ููุญุฐู
    window.onload = async function() {
        const snap = await db.collection(COLLECTION).orderBy("createdAt", "desc").get();
        document.getElementById('data-list').innerHTML = snap.docs.map(doc => `
            <div style="display:flex; justify-content:space-between; padding:10px;">
                <span>${doc.data().title}</span>
                <button onclick="db.collection('${COLLECTION}').doc('${doc.id}').delete().then(()=>location.reload())">ุญุฐู ๐๏ธ</button>
            </div>
        `).join('');
    };
</script>
</body>
</html>