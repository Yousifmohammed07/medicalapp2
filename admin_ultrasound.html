<!DOCTYPE html>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="firebase-config.js"></script>

<script>
    // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    firebase.auth().onAuthStateChanged((user) => {
        if (!user) {
            // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…Ø³Ø¬Ù„Ø§Ù‹ØŒ Ø§Ø·Ø±Ø¯Ù‡ Ù„ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            window.location.href = "login.html";
        }
    });

    function logout() {
        firebase.auth().signOut().then(() => {
            window.location.href = "login.html";
        });
    }
</script>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style.css">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø¯Ø±ÙˆØ³ Ø§Ù„Ø³ÙˆÙ†Ø§Ø± - ÙƒØ§Ù…ÙŠØ±Ø§ Ø·Ø¨ÙŠØ©</title>
</head>
<body>
    <nav>
        <a href="admin_hub.html" class="logo">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³ÙˆÙ†Ø§Ø± ğŸ”Š</a>
        <button class="btn-primary" onclick="location.href='admin_hub.html'" style="width:auto; padding: 5px 15px;">â¬…ï¸ Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
    </nav>

    <div class="container">
        <div class="card">
            <h2 style="color:var(--yellow); text-align:center;">ğŸ§¬ Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø³ ÙÙŠØ²ÙŠØ§Ø¡ Ø§Ù„Ø³ÙˆÙ†Ø§Ø±</h2>
            <input type="text" id="titleAr" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯Ø±Ø³ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©" style="width:100%; padding:12px; margin-bottom:10px; border-radius:8px; border:1px solid var(--orange); background:transparent; color:white;">
            <input type="text" id="titleEn" placeholder="Lesson Title (English)" dir="ltr" style="width:100%; padding:12px; margin-bottom:20px; border-radius:8px; border:1px solid var(--orange); background:transparent; color:white;">

            <div id="blocks-container"></div>

            <div style="margin-top:20px; text-align:center; display:flex; gap:10px; justify-content:center;">
                <button class="btn-primary" style="background:#27ae60; width:auto;" onclick="addBlock('text')">â• Ù†Øµ</button>
                <button class="btn-primary" style="background:#2980b9; width:auto;" onclick="addBlock('image')">ğŸ“· ØµÙˆØ±Ø©</button>
            </div>

            <button class="btn-primary" style="margin-top:30px;" onclick="saveLesson()">ğŸš€ Ù†Ø´Ø± Ø§Ù„Ø¯Ø±Ø³</button>
        </div>

        <div class="card">
            <h3 style="color:var(--orange);">ğŸ“‚ Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ù…Ø¶Ø§ÙØ©:</h3>
            <div id="lessons-list"></div>
        </div>
    </div>

    <script>
        function addBlock(type) {
            const id = Date.now();
            const container = document.getElementById('blocks-container');
            let html = `<div class="block" id="${id}" style="border:1px dashed #555; padding:15px; margin-top:10px; position:relative;">
                <button onclick="document.getElementById('${id}').remove()" style="position:absolute; left:5px; top:5px; background:none; border:none; color:red; cursor:pointer;">X</button>`;
            
            if(type === 'text') {
                html += `<label>Ù†Øµ Ø§Ù„Ø´Ø±Ø­:</label><textarea class="block-data" data-type="text" rows="3" style="width:100%; background:rgba(255,255,255,0.05); color:white; border-radius:5px;"></textarea>`;
            } else {
                html += `<label>Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©:</label><input type="file" onchange="handleImg(event, '${id}')" accept="image/*" style="color:white;">
                         <input type="hidden" class="block-data" data-type="image" id="hidden-${id}">
                         <img id="preview-${id}" style="width:100%; max-height:150px; display:none; margin-top:10px; border-radius:5px;">`;
            }
            html += `</div>`;
            container.insertAdjacentHTML('beforeend', html);
        }

        function handleImg(e, id) {
            const reader = new FileReader();
            reader.onload = f => {
                document.getElementById(`preview-${id}`).src = f.target.result;
                document.getElementById(`preview-${id}`).style.display = "block";
                document.getElementById(`hidden-${id}`).value = f.target.result;
            };
            reader.readAsDataURL(e.target.files[0]);
        }

        function saveLesson() {
            const titleAr = document.getElementById('titleAr').value;
            const titleEn = document.getElementById('titleEn').value;
            const blocks = document.querySelectorAll('.block-data');
            let content = [];
            blocks.forEach(b => content.push({ type: b.dataset.type, value: b.value }));

            if(!titleAr || content.length === 0) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!");

            let lessons = JSON.parse(localStorage.getItem('us_lessons')) || [];
            lessons.push({ titleAr, titleEn, content });
            localStorage.setItem('us_lessons', JSON.stringify(lessons));
            alert("ØªÙ… Ø§Ù„Ø­ÙØ¸!");
            location.reload();
        }

        window.onload = function() {
            const list = document.getElementById('lessons-list');
            const lessons = JSON.parse(localStorage.getItem('us_lessons')) || [];
            list.innerHTML = lessons.map((l, i) => `<div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #333;">
                <span>${l.titleAr}</span>
                <button onclick="deleteL(${i})" style="color:red; background:none; border:none; cursor:pointer;">Ø­Ø°Ù ğŸ—‘ï¸</button>
            </div>`).join('');
        };

        function deleteL(i) {
            let lessons = JSON.parse(localStorage.getItem('us_lessons'));
            lessons.splice(i, 1);
            localStorage.setItem('us_lessons', JSON.stringify(lessons));
            location.reload();
        }
    </script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="firebase-config.js"></script>
    
    
    <script>
    const COLLECTION = "ultrasound"; // ğŸ’¡ ØºÙŠØ±Ù‡Ø§ Ø¥Ù„Ù‰ us_lessons Ø£Ùˆ rad_protection Ø­Ø³Ø¨ Ø§Ù„ØµÙØ­Ø©

    async function saveData() {
        const title = document.querySelector('input').value;
        const desc = document.querySelector('textarea').value;
        
        await db.collection(COLLECTION).add({
            title, desc, createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        location.reload();
    }

    // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø­Ø°Ù
    window.onload = async function() {
        const snap = await db.collection(COLLECTION).orderBy("createdAt", "desc").get();
        document.getElementById('data-list').innerHTML = snap.docs.map(doc => `
            <div style="display:flex; justify-content:space-between; padding:10px;">
                <span>${doc.data().title}</span>
                <button onclick="db.collection('${COLLECTION}').doc('${doc.id}').delete().then(()=>location.reload())">Ø­Ø°Ù ğŸ—‘ï¸</button>
            </div>
        `).join('');
    };
</script>
</body>
</html>