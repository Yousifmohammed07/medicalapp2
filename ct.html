<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <title>ÙÙŠØ²ÙŠØ§Ø¡ Ø§Ù„Ù…ÙØ±Ø§Ø³ (CT Scan) - ÙƒØ§Ù…ÙŠØ±Ø§ Ø·Ø¨ÙŠØ©</title>
    <style>
        .tool-box { 
            background: linear-gradient(45deg, #001f3f, #003366); 
            border: 2px solid var(--orange); 
        }
        .math-display { 
            font-size: 1.5rem; 
            color: var(--yellow); 
            margin: 15px 0; 
            background: rgba(0,0,0,0.3); 
            padding: 15px; 
            border-radius: 12px;
            text-align: center;
        }
        .lessons-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
            gap: 20px; 
            margin-top: 30px; 
        }
        .modal { 
            display: none; 
            position: fixed; 
            z-index: 2000; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.95); 
            overflow-y: auto; 
        }
        .modal-content { 
            background: var(--bg-color); 
            margin: 5% auto; 
            padding: 30px; 
            width: 90%; 
            max-width: 850px; 
            border-radius: 20px; 
            border: 2px solid var(--yellow); 
            position: relative;
        }
        .close-btn { 
            position: sticky; 
            top: 0; 
            float: left; 
            font-size: 35px; 
            cursor: pointer; 
            color: var(--orange); 
            z-index: 10;
        }
        .text-block { line-height: 1.8; margin-bottom: 20px; white-space: pre-line; font-size: 1.1rem; }
        .content-img { width: 100%; border-radius: 12px; border: 2px solid var(--orange); margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        
        input[type="number"] {
            width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--orange); 
            background: rgba(255,255,255,0.05); color: white; box-sizing: border-box; font-size: 1rem;
        }
    </style>
</head>
<body>
    <nav>
        <a href="index.html" class="logo">ÙƒØ§Ù…ÙŠØ±Ø§ Ø·Ø¨ÙŠØ© ğŸ“·</a>
        <div class="dropdown">
            <button onclick="toggleMenu()" class="dropbtn">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© â˜°</button>
            <div id="myDropdown" class="dropdown-content">
                 <a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                <a href="physics_calc.html">Ø§Ù„Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¦ÙŠØ© ğŸ§®</a>
                <a href="contrast_guide.html">Ø¯Ù„ÙŠÙ„ Ø§Ù„ØµØ¨ØºØ§Øª ğŸ§ª</a>
                <a href="exam.html">Ù…Ø±ÙƒØ² Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</a>
                <a href="anatomy.html">ØªØ­Ø¯ÙŠ Ø§Ù„ØªØ´Ø±ÙŠØ­</a>
                <a href="atlas.html">Ø£Ø·Ù„Ø³ Ø§Ù„ÙˆØ¶Ø¹ÙŠØ§Øª</a>
                <a href="artifacts.html">Ù…Ø®ØªØ¨Ø± Ø§Ù„ØµÙˆØ±</a>
                <a href="safety.html">ØªØ­Ø¯ÙŠ Ø§Ù„Ø³Ù„Ø§Ù…Ø©</a>
                <a href="ct.html">CT Scan</a>
                <a href="xray.html">X-ray</a>
                <a href="mri.html">MRI</a>
                <a href="ultrasound.html">ÙÙŠØ²ÙŠØ§Ø¡ Ø§Ù„Ø³ÙˆÙ†Ø§Ø± ğŸ”Š</a>
                <a href="qc_lab.html">Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø±Ù‚Ø§Ø¨Ø© Ø§Ù„Ù†ÙˆØ¹ÙŠØ© ğŸ› ï¸</a>
                <a href="protection.html">Ø§Ù„ÙˆÙ‚Ø§ÙŠØ© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø¹ÙŠØ© ğŸ›¡ï¸</a>
                <a href="physics_sim.html">Ù…Ø­Ø§ÙƒÙŠ Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡ âš›ï¸</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="card tool-box">
            <h2 style="color:var(--yellow); text-align:center;">ğŸ“Š Ø­Ø§Ø³Ø¨Ø© Ù…Ø¤Ø´Ø± Ø§Ù„Ø¬Ø±Ø¹Ø© (CTDI)</h2>
            
            <div class="math-display">
                \[ Dose \propto kVp^2 \times mAs \]
            </div>
            
            <p style="text-align:center; color: #ccc; margin-bottom: 20px;">
                Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø®Ø·Ø· Ù„Ù‡Ø§ Ù„Ø­Ø³Ø§Ø¨ Ù…Ø¤Ø´Ø± Ø§Ù„Ø¬Ø±Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠ Ø¨Ø§Ù„Ù€ Ù…ÙŠÙ„Ù„ÙŠ ØºØ±Ø§ÙŠ.
            </p>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <label style="display:block; margin-bottom:8px;">Ø§Ù„Ø¬Ù‡Ø¯ (kVp):</label>
                    <input type="number" id="kv-input" value="120">
                </div>
                <div>
                    <label style="display:block; margin-bottom:8px;">Ø§Ù„ØªÙŠØ§Ø± (mAs):</label>
                    <input type="number" id="mas-input" value="100">
                </div>
            </div>
            
            <button class="btn-primary" style="margin-top:20px;" onclick="calculateDose()">Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¢Ù†</button>
            
            <div id="dose-result" style="margin-top:25px; text-align:center; min-height: 40px;"></div>
        </div>

        <h2 style="margin-top:50px; border-bottom: 2px solid var(--orange); padding-bottom:10px;">ğŸ“š Ù…ÙˆØ³ÙˆØ¹Ø© ÙÙŠØ²ÙŠØ§Ø¡ Ø§Ù„Ù…ÙØ±Ø§Ø³</h2>
        <div id="ct-lessons-container" class="lessons-grid">
            </div>
    </div>

    <div id="lessonModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <div id="modal-body"></div>
        </div>
    </div>

    <script>
        // Ø¯Ø§Ù„Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¬Ø±Ø¹Ø© Ù…Ø¹ ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆØ­Ø¯Ø© ÙƒØ§Ø®ØªØµØ§Ø± Ù†ØµÙŠ
        function calculateDose() {
            const kv = parseFloat(document.getElementById('kv-input').value);
            const mas = parseFloat(document.getElementById('mas-input').value);
            
            if (isNaN(kv) || isNaN(mas)) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù‚ÙŠÙ… ØµØ­ÙŠØ­Ø©");

            // Ù…Ø¹Ø§Ø¯Ù„Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ© ØªÙ‚Ø±ÙŠØ¨ÙŠØ©: Dose = (kV/120)^2 * (mAs/100) * 12
            const result = (Math.pow(kv/120, 2) * (mas/100) * 12).toFixed(2);
            
            const resDiv = document.getElementById('dose-result');
            // Ø§Ù„Ø±Ù‚Ù… Ø¨Ù„ÙˆÙ† Ø£ØµÙØ± ÙˆØ§Ù„ÙˆØ­Ø¯Ø© Ù†ØµÙŠØ© Ø¨ÙŠØ¶Ø§Ø¡ ÙˆØ§Ø¶Ø­Ø© (mGy)
            resDiv.innerHTML = `
                <span style="font-size:1.2rem; color:white;">Ø§Ù„Ø¬Ø±Ø¹Ø© Ø§Ù„Ù†Ø§ØªØ¬Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ©:</span><br>
                <span style="color:var(--yellow); font-size:2rem; font-weight:bold; font-family: sans-serif;">${result}</span>
                <span style="color:white; font-size:1.3rem; margin-right:8px; font-weight:bold;">mGy</span>
            `;
        }

        // ØªØ­Ù…ÙŠÙ„ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø¯Ø±ÙˆØ³ Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        window.onload = function() {
            const container = document.getElementById('ct-lessons-container');
            const lessons = JSON.parse(localStorage.getItem('ct_lessons')) || [];

            if(lessons.length === 0) {
                container.innerHTML = "<p style='text-align:center; grid-column:1/-1; color:gray;'>  Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯Ø±ÙˆØ³ Ù…Ø¶Ø§ÙØ© Ø­Ø§Ù„ÙŠØ§Ù‹.</p>";
                return;
            }

            container.innerHTML = lessons.map((l, i) => `
                <div class="card" style="cursor:pointer; text-align:center; border:1px solid rgba(255,215,0,0.2); transition:0.3s;" 
                     onclick="openLesson(${i})" onmouseover="this.style.borderColor='var(--orange)'" onmouseout="this.style.borderColor='rgba(255,215,0,0.2)'">
                    <h3 style="color:var(--yellow); margin-bottom:5px;">${l.titleAr}</h3>
                    <p style="color:#8892b0; font-size:0.9rem; margin-bottom:15px;">${l.titleEn}</p>
                    <button class="btn-primary" style="width:auto; padding:8px 25px;">Ø§Ù‚Ø±Ø£ Ø§Ù„Ø¯Ø±Ø³ ğŸ“–</button>
                </div>
            `).join('');
        };

        // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¯Ø±Ø³ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù…Ù‚Ø§Ø·Ø¹
        function openLesson(i) {
            const lessons = JSON.parse(localStorage.getItem('ct_lessons'));
            const lesson = lessons[i];
            const body = document.getElementById('modal-body');
            
            let html = `
                <h2 style="color:var(--yellow); margin-bottom:5px;">${lesson.titleAr}</h2>
                <h4 style="color:#8892b0; margin-top:0; border-bottom:1px solid #333; padding-bottom:15px;">${lesson.titleEn}</h4>
            `;
            
            lesson.content.forEach(block => {
                if(block.type === 'text') {
                    html += `<div class="text-block">${block.value}</div>`;
                } else if(block.type === 'image') {
                    html += `<img src="${block.value}" class="content-img" alt="ØµÙˆØ±Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ©">`;
                }
            });

            body.innerHTML = html;
            document.getElementById('lessonModal').style.display = "block";
            
            // ØªÙØ¹ÙŠÙ„ MathJax Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª ÙÙŠ Ø§Ù„Ø´Ø±Ø­
            if(window.MathJax) {
                MathJax.typesetPromise([body]);
            }
        }

        function closeModal() {
            document.getElementById('lessonModal').style.display = "none";
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬Ù‡Ø§
        window.onclick = function(event) {
            const modal = document.getElementById('lessonModal');
            if (event.target == modal) closeModal();
        };

        function toggleMenu() {
            document.getElementById("myDropdown").classList.toggle("show");
        }
    </script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="firebase-config.js"></script>
    
    <script>
    window.onload = async function() {
        const COLLECTION = "ct"; // ğŸ’¡ Ù†ÙØ³ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
        const snap = await db.collection(COLLECTION).orderBy("createdAt", "desc").get();
        
        document.getElementById('display-grid').innerHTML = snap.docs.map(doc => `
            <div class="card">
                <h3>${doc.data().title}</h3>
                <p>${doc.data().desc}</p>
            </div>
        `).join('');
    };
</script>
</body>
</html>